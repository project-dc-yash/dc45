<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriTwin | Historical Data Vault</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2ecc71;
            --dark-bg: #0d1117;
            --card-bg: #161b22;
            --border: #30363d;
            --text: #c9d1d9;
            --highlight: #f1c40f;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--dark-bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* Navigation */
        nav { width: 80px; background: #010409; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 20px 0; }
        .nav-btn { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; color: #8b949e; cursor: pointer; border-radius: 12px; margin-bottom: 20px; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); background: rgba(46, 204, 113, 0.1); }

        /* Main Content */
        main { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; }
        
        .grid-top { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        .chart-box, .summary-box { background: var(--card-bg); border-radius: 20px; border: 1px solid var(--border); padding: 25px; }

        /* Data Table Styling */
        .table-container { background: var(--card-bg); border-radius: 20px; border: 1px solid var(--border); padding: 25px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th { text-align: left; padding: 15px; border-bottom: 2px solid var(--border); color: #8b949e; text-transform: uppercase; font-size: 0.75rem; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        tr:hover { background: rgba(255,255,255,0.02); }

        /* Status Badges */
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; }
        .bg-green { background: rgba(46, 204, 113, 0.1); color: var(--primary); }
        .bg-yellow { background: rgba(241, 196, 15, 0.1); color: var(--highlight); }

        .export-btn { background: var(--primary); color: black; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        
        canvas { max-height: 250px; }
    </style>
</head>
<body>

    <nav>
        <div class="nav-btn"><i class="fas fa-th-large"></i></div>
        <div class="nav-btn"><i class="fas fa-leaf"></i></div>
        <div class="nav-btn active"><i class="fas fa-history"></i></div>
        <div class="nav-btn"><i class="fas fa-file-export"></i></div>
    </nav>

    <main>
        <div class="header">
            <div>
                <h1>History Logs</h1>
                <p style="color: #8b949e;">Full environmental telemetry archive from ESP32 Nodes.</p>
            </div>
            <button class="export-btn"><i class="fas fa-download"></i> Export CSV</button>
        </div>

        <div class="grid-top">
            <div class="chart-box">
                <h2>7-Day Growth Parameter Trend</h2>
                <canvas id="historyChart"></canvas>
            </div>

            <div class="summary-box">
                <h2>AI Field Insight</h2>
                <div style="margin-top: 15px;">
                    <p style="font-size: 0.9rem; margin-bottom: 10px;">
                        <i class="fas fa-robot" style="color: var(--primary);"></i> 
                        <strong>Observation:</strong> Over the last 48 hours, soil moisture has dropped by 12% in the Mango sector.
                    </p>
                    <p style="font-size: 0.8rem; color: #8b949e;">
                        <strong>Action Taken:</strong> Automatic irrigation triggered via Node-Beta on Jan 18.
                    </p>
                    <hr style="border: 0; border-top: 1px solid var(--border); margin: 15px 0;">
                    <p style="font-size: 0.8rem;">
                        <span style="color: var(--highlight);">Warning:</span> Temperature spike detected at 2:00 PM daily. Consider adding shade nets for Coffee bushes.
                    </p>
                </div>
            </div>
        </div>

        <div class="table-container">
            <h2>Detailed Sensor Logs</h2>
            <table>
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Node ID</th>
                        <th>Crop Type</th>
                        <th>Temp (Â°C)</th>
                        <th>Moisture (%)</th>
                        <th>Humidity (%)</th>
                        <th>Diagnosis</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="logTableBody">
                    </tbody>
            </table>
        </div>
    </main>

    <script>
        // Sample Historical Data for Banana, Mango, Coffee
        const historyData = [
            { time: "2026-01-19 14:00", node: "ESP32-01", crop: "Banana", temp: 28.5, moist: 42, hum: 65, diag: "Healthy", status: "Optimal" },
            { time: "2026-01-19 12:00", node: "ESP32-02", crop: "Mango", temp: 31.2, moist: 38, hum: 58, diag: "Dry Soil", status: "Warning" },
            { time: "2026-01-19 10:00", node: "ESP32-03", crop: "Coffee", temp: 24.1, moist: 55, hum: 70, diag: "Healthy", status: "Optimal" },
            { time: "2026-01-18 16:00", node: "ESP32-01", crop: "Banana", temp: 27.8, moist: 44, hum: 66, diag: "Healthy", status: "Optimal" },
            { time: "2026-01-18 14:00", node: "ESP32-02", crop: "Mango", temp: 32.5, moist: 35, hum: 55, diag: "Pest Alert", status: "Warning" },
            { time: "2026-01-18 08:00", node: "ESP32-03", crop: "Coffee", temp: 22.4, moist: 58, hum: 72, diag: "Healthy", status: "Optimal" }
        ];

        // Populate Table
        const tableBody = document.getElementById('logTableBody');
        historyData.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${row.time}</td>
                <td><code style="color:var(--highlight)">${row.node}</code></td>
                <td>${row.crop}</td>
                <td>${row.temp}</td>
                <td>${row.moist}</td>
                <td>${row.hum}</td>
                <td>${row.diag}</td>
                <td><span class="badge ${row.status === 'Optimal' ? 'bg-green' : 'bg-yellow'}">${row.status}</span></td>
            `;
            tableBody.appendChild(tr);
        });

        // History Trend Chart
        const ctx = document.getElementById('historyChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [
                    {
                        label: 'Avg Moisture',
                        data: [45, 42, 48, 40, 38, 41, 44],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Avg Temperature',
                        data: [26, 28, 25, 30, 31, 29, 27],
                        borderColor: '#f1c40f',
                        fill: false,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: { legend: { labels: { color: '#8b949e' } } },
                scales: {
                    x: { ticks: { color: '#8b949e' }, grid: { color: '#30363d' } },
                    y: { ticks: { color: '#8b949e' }, grid: { color: '#30363d' } }
                }
            }
        });
    </script>
</body>
</html>